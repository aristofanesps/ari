<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro de Recebimento</title>
  <style>
    /* Seu estilo CSS existente */
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      color: rgba(0, 0, 0, 0.822);
    }

    label {
      display: block;
      margin-top: 10px;
    }

    select, input {
      padding: 5px;
      margin-top: 5px;
    }

    button {
      padding: 8px;
      background-color: #4caf50;
      color: white;
      border: none;
      cursor: pointer;
      margin-top: 10px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #f2f2f2;
    }

    .scroll-container {
      width: 600px;
      height: 200px;
      overflow: auto;
      border: 1px solid #ccc;
      padding: 10px;
    }

    /* Novo estilo para centralizar */
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #epi1{
        width: 300px;
    }
    .estoque-info{
    display: flex;
    flex-direction: column; /* Garante que os itens fiquem em uma coluna */
    justify-content: center;
    align-items: center;
    }
    #filtrarDados{
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
      padding: 23px;
      margin-top: -41px;
    
    }
    #fil{
      padding: 10px;
    }
    #tiJaboatao{
      display: flex;
      gap: 34px;
      align-items: flex-start;
      width: 50%;
    }
   
    
    #img1{
      width: 170px;
      height: 70px;
    }
    #botao{
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 23px;
    }
    
  </style>
</head>
<body>

  <div class="container">
    <div id="tiJaboatao">
      <img id="img1" src="imgLogoNovaMobi.png" alt="">
      <h1>TI JABOATÃO</h1>
    </div>
    <h2>Registro de Recebimento de EPIs</h2>

    <!-- Restante do seu conteúdo aqui -->
    

    <label for="matricula">RE:</label>
    <input type="number" id="matricula" placeholder="Digite RE do colaborador">

    <label for="receivedByName">Nome do colaborador</label>
    <input type="text" id="receivedByName" placeholder="Digite nome do colaborador">

    <label for="productName">Escolha o EPI:</label>
    <select id="productName">
      <option value="disabled selected">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Selecione...</option>
      <option value="Luva de Látex (amarela)">Luva de Látex (amarela)</option>
      <option value="Luva Nitrílica (verde)">Luva Nitrílica (verde)</option>
      <option value="Luva Pigmentada (algodão)">Luva Pigmentada (algodão)</option>
      <option value="Luva Nitrilon">Luva Nitrilon</option>
      <option value="Avental de Napa (preto)">Avental de Napa (preto)</option>
      <option value="Colete Refletivo">Colete Refletivo</option> 
      <option value="Máscara PFF2 (azul)">Máscara PFF2 (azul)</option>
      <option value="Protetor Auricular">Protetor Auricular</option>
      <option value="Óculos de Segurança">Óculos de Segurança</option>
      <option value="Boné">Boné</option>
      <option value="Boné Árabe">Boné Árabe</option>
      <option value="Capa de Chuva">Capa de Chuva</option>
      
    </select>

    <button onclick="registrarRecebimento()">Registrar Recebimento</button>
    <h3>Controle de recebimento de EPIs</h3>
    
    <div class="scroll-container">
      <table id="recebimentosTable">
        <thead>
          <tr>
            <th>RE</th>
            <th>Nome do colaborador</th>
            <th>EPI entregue</th>
            <th>Data</th>
          </tr>
        </thead>
        <tbody id="recebimentosTbody">
          <!-- Dados da tabela serão adicionados dinamicamente pelo JavaScript -->
        </tbody>
      </table>
    </div>

    <div class="estoque-info">
      
      <!-- Adicione esta tabela abaixo das informações de estoque -->
      <table id="estoqueTable">
        <h3>Movimentação no estoque</h3>
        <thead>
          <tr>
            <th id="epi1">EPIs</th>
            <th>Qtd. em Estoque</th>
          </tr>
        <tbody>
          <tr>
            <td>Luva de Látex (amarela)</td>
            <td id="estoqueInicialLatex">2</td>
          </tr>
          <tr>
            <td>Luva Nitrílica (verde)</td>
            <td id="estoqueInicialNitrilica">10</td>
          </tr>
          <tr>
            <td>Luva Pigmentada (algodão)</td>
            <td id="estoqueInicialPigmentada">10</td>
          </tr>
          <tr>
            <td>Luva Nitrilon</td>
            <td id="estoqueInicialNitrilon">12</td>
          </tr>
          <tr>
            <td>Avental de Napa (preto)</td>
            <td id="estoqueInicialAvental">12</td>
          </tr>
          <tr>
            <td>Colete Refletivo</td>
            <td id="estoqueInicialColete">12</td>
          </tr>
          <tr>
            <td>Máscara PFF2 (azul)</td>
            <td id="estoqueInicialMascara">12</td>
          </tr>
          <tr>
            <td>Protetor Auricular</td>
            <td id="estoqueInicialProtetor">12</td>
          </tr>
          <tr>
            <td>Óculos de Segurança</td>
            <td id="estoqueInicialOculos">12</td>
          </tr>
          <tr>
            <td>Boné</td>
            <td id="estoqueInicialBone">12</td>
          </tr>
          <tr>
            <td>Boné Árabe</td>
            <td id="estoqueInicialBoneArabe">12</td>
          </tr>
          <tr>
            <td>Capa de Chuva</td>
            <td id="estoqueInicialCapa">12</td>
          </tr>
        </tbody>
      </table>
      <h3>Filtrar dados</h3>
      <div id="filtrarDados">
        <div id="fil">
          
          <label for="filterMatricula">Filtrar por RE:</label>
          <input type="text" id="filterMatricula" oninput="filtrarDados('filterMatricula', 0)">
          

          <label for="filterName">Filtrar por Nome:</label>
          <input type="text" id="filterName" oninput="filtrarDados('filterName', 1)">

        </div>
        
        <div>
          <label for="filterProduct">Filtrar por EPI:</label>
          <input type="text" id="filterProduct" oninput="filtrarDados('filterProduct', 2)">

          <label for="filterDate">Filtrar por Data:</label>
          <input type="text" id="filterDate" oninput="filtrarDados('filterDate', 3)">

        </div>

        

      </div>
      <div>

      </div>
      
        
    </div>

  
  </div>

  <script>
  
    // Seu JavaScript existente
    // ...
     // Função para obter a data e hora formatadas
      function obterDataHoraFormatada() {
        var data = new Date();
        var options = {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
          hour12: false
        };

        // Formate a data e hora
        var dataHoraFormatada = data.toLocaleString("pt-BR", options);
        return dataHoraFormatada;
      }

      // Seu JavaScript existente
      // ...
      // Função para carregar o estoque do armazenamento local
      function carregarEstoqueDoLocalStorage() {
        var estoqueSalvo = localStorage.getItem("estoque");

        if (estoqueSalvo) {
          estoque = JSON.parse(estoqueSalvo);
          exibirEstoque();
          calcularSomaEstoque();
        }
      }

      // Função para salvar o estoque no armazenamento local
      function salvarEstoqueNoLocalStorage() {
        localStorage.setItem("estoque", JSON.stringify(estoque));
      }

      // Função para carregar os dados do scroll-container do armazenamento local
      function carregarDadosDoLocalStorage() {
        var dadosSalvos = localStorage.getItem("dadosScrollContainer");

        if (dadosSalvos) {
          document.getElementById("recebimentosTbody").innerHTML = dadosSalvos;
        }
      }

      // Função para salvar os dados do scroll-container no armazenamento local
      function salvarDadosNoLocalStorage() {
        var dadosScrollContainer = document.getElementById("recebimentosTbody").innerHTML;
        localStorage.setItem("dadosScrollContainer", dadosScrollContainer);
      }

      var estoque = localStorage.getItem("estoque")
  ? JSON.parse(localStorage.getItem("estoque"))
  : {
      "Luva de Látex (amarela)": 2,
      "Luva Nitrílica (verde)": 10,
      "Luva Pigmentada (algodão)": 10,
      "Luva Nitrilon": 12,
      "Avental de Napa (preto)": 12,
      "Colete Refletivo": 12,
      "Máscara PFF2 (azul)": 12,
      "Protetor Auricular": 12,
      "Óculos de Segurança": 12,
      "Boné": 12,
      "Boné Árabe": 12,
      "Capa de Chuva": 12



    };

      // Carregue o estoque e os dados do scroll-container ao inicializar a página
      carregarEstoqueDoLocalStorage();
      carregarDadosDoLocalStorage();

      function registrarRecebimento() {
        var productName = document.getElementById("productName").value;
        var receivedByName = document.getElementById("receivedByName").value;
        var matricula = document.getElementById("matricula").value;
        var currentDate = obterDataHoraFormatada(); // Obtém a data e hora atuais

        if (productName && receivedByName && matricula) {
          var tableBody = document.getElementById("recebimentosTbody");

          if (estoque[productName] > 0) {
            var newRow = tableBody.insertRow(tableBody.rows.length);
            var cell1 = newRow.insertCell(0);
            var cell2 = newRow.insertCell(1);
            var cell3 = newRow.insertCell(2);
            var cell4 = newRow.insertCell(3);

            cell1.innerHTML = matricula;
            cell2.innerHTML = receivedByName;
            cell3.innerHTML = productName;
            cell4.innerHTML = currentDate;

            estoque[productName]--;
            exibirEstoque();
            salvarDadosNoLocalStorage();

            document.getElementById("receivedByName").value = "";
            document.getElementById("matricula").value = "";
          } else {
            alert("Estoque do produto " + productName + " esgotado!");
          }
        } else {
          alert("Por favor, preencha todos os campos.");
        }
      }

      function exibirEstoque() {
        document.getElementById("estoqueInicialLatex").innerText = estoque["Luva de Látex (amarela)"];
        document.getElementById("estoqueInicialNitrilica").innerText = estoque["Luva Nitrílica (verde)"];
        document.getElementById("estoqueInicialPigmentada").innerText = estoque["Luva Pigmentada (algodão)"];
        document.getElementById("estoqueInicialNitrilon").innerText = estoque["Luva Nitrilon"];
        document.getElementById("estoqueInicialAvental").innerText = estoque["Avental de Napa (preto)"];
        document.getElementById("estoqueInicialColete").innerText = estoque["Colete Refletivo"];
        document.getElementById("estoqueInicialMascara").innerText = estoque["Máscara PFF2 (azul)"];
        document.getElementById("estoqueInicialProtetor").innerText = estoque["Protetor Auricular"];
        document.getElementById("estoqueInicialOculos").innerText = estoque["Óculos de Segurança"];
        document.getElementById("estoqueInicialBone").innerText = estoque["Boné"];
        document.getElementById("estoqueInicialBoneArabe").innerText = estoque["Boné Árabe"];
        document.getElementById("estoqueInicialCapa").innerText = estoque["Capa de Chuva"];
      }

    function calcularSomaEstoque() {
        var somaEstoque = 0;

        for (var item in estoque) {
            if (estoque.hasOwnProperty(item)) {
                somaEstoque +=parseInt(estoque[item]);
        }
    }

      var elemento=document.getElementById("totalEstoque");
      if (elemento) { // Define o estilo do elemento para ocultar (display: none) elemento.style.display = 'none'; 
}
}



    

      // Chame a função exibirEstoque para exibir o estoque inicial ao carregar a página
      exibirEstoque();

      // Atualize a tabela e o estoque ao carregar a página
      window.onload = function () {
        carregarEstoqueDoLocalStorage();
        carregarDadosDoLocalStorage();
        exibirEstoque();
        calcularSomaEstoque();
      };

      function alterarEstoqueInicial() {
        var novoEstoqueLatex = parseInt(prompt("Digite o novo valor para o estoque de Luva de Látex (amarela):"));
        var novoEstoqueNitrilica = parseInt(prompt("Digite o novo valor para o estoque de Luva Nitrílica (verde):"));
        var novoEstoquePigmentada = parseInt(prompt("Digite o novo valor para o estoque de Luva Pigmentada (algodão):"));
        var novoEstoqueNitrilon = parseInt(prompt("Digite o novo valor para o estoque de Luva Nitrilon:"));
        var novoEstoqueAvental = parseInt(prompt("Digite o novo valor para o estoque de Avental de Napa (preto):"));
        var novoEstoqueColete = parseInt(prompt("Digite o novo valor para o estoque de Colete Refletivo:"));
        var novoEstoqueMascara = parseInt(prompt("Digite o novo valor para o estoque de Máscara PFF2:"));
        var novoEstoqueProtetor = parseInt(prompt("Digite o novo valor para o estoque de Protetor Auricular:"));
        var novoEstoqueOculos = parseInt(prompt("Digite o novo valor para o estoque de Óculos de Segurança:"));
        var novoEstoqueBone = parseInt(prompt("Digite o novo valor para o estoque de Boné:"));
        var novoEstoqueBoneArabe = parseInt(prompt("Digite o novo valor para o estoque de Boné Árabe:"));
        var novoEstoqueCapa = parseInt(prompt("Digite o novo valor para o estoque de Capa de Chuva:"));



        // Verifique se os valores digitados são números válidos
        if (!isNaN(novoEstoqueLatex) && !isNaN(novoEstoqueNitrilica) && !isNaN(novoEstoquePigmentada) && !isNaN(novoEstoqueNitrilon) && !isNaN(novoEstoqueAvental) && !isNaN(novoEstoqueColete) && !isNaN(novoEstoqueMascara) && !isNaN(novoEstoqueProtetor) && !isNaN(novoEstoqueOculos) && !isNaN(novoEstoqueBone) && !isNaN(novoEstoqueBoneArabe) && !isNaN(novoEstoqueCapa)) {
          estoque["Luva de Látex (amarela)"] = novoEstoqueLatex;
          estoque["Luva Nitrílica (verde)"] = novoEstoqueNitrilica;
          estoque["Luva Pigmentada (algodão)"] = novoEstoquePigmentada;
          estoque["Luva Nitrilon"] = novoEstoqueNitrilon;
          estoque["Avental de Napa (preto)"] = novoEstoqueAvental;
          estoque["Colete Refletivo"] = novoEstoqueColete;
          estoque["Máscara PFF2 (azul)"] = novoEstoqueMascara;
          estoque["Protetor Auricular"] = novoEstoqueProtetor;
          estoque["Óculos de Segurança"] = novoEstoqueOculos;
          estoque["Boné"] = novoEstoqueBone;
          estoque["Boné Árabe"] = novoEstoqueBoneArabe;
          estoque["Capa de Chuva"] = novoEstoqueCapa;


          // Exiba o estoque atualizado
          exibirEstoque();
          calcularSomaEstoque();

          // Salve o estoque no armazenamento local
          salvarEstoqueNoLocalStorage();
        } else {
          alert("Por favor, digite valores numéricos válidos.");
        }
      }

      function acessarAlteracaoEstoque() {
        var senha = prompt("Digite a senha para acessar:");

        // Verifique se a senha é correta (substitua 'suaSenhaAqui' pela senha desejada)
        if (senha === "1234") {
          alterarEstoqueInicial();
        } else {
          alert("Senha incorreta. Acesso negado.");
        }
      }

      function limparDadosLocalStorage() {
        // Carregar o estoque do LocalStorage antes de limpar os dados do scroll-container
        carregarEstoqueDoLocalStorage();

        // Remover apenas os dados do scroll-container
        localStorage.removeItem("dadosScrollContainer");

        alert("Dados do LocalStorage (exceto scroll-container) limpos!");
      }

      // Função para filtrar os dados na tabela
      function filtrarDados(inputId, columnIndex) {
        var input, filter, table, tbody, tr, td, i, txtValue;
        input = document.getElementById(inputId);
        filter = input.value.toUpperCase();
        table = document.getElementById("recebimentosTable");
        tbody = table.getElementsByTagName("tbody")[0];
        tr = tbody.getElementsByTagName("tr");

        for (i = 0; i < tr.length; i++) {
          td = tr[i].getElementsByTagName("td")[columnIndex];
          if (td) {
            txtValue = td.textContent || td.innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
              tr[i].style.display = "";
            } else {
              tr[i].style.display = "none";
            }
          }
        }
      }
function limparDadosLocalStorage() {
    // Solicitar a senha ao usuário
    var senhaInserida = prompt("Digite a senha para limpar os dados:");

    // Verificar se a senha está correta
    if (senhaInserida === "1234") {
        // Carregar o estoque do LocalStorage antes de limpar os dados do scroll-container
        carregarEstoqueDoLocalStorage();

        // Remover apenas os dados do scroll-container
        localStorage.removeItem("dadosScrollContainer");

        alert("Dados do LocalStorage (exceto scroll-container) limpos!");
    } else {
        alert("Senha incorreta. Acesso negado.");
    }
}

    // Aqui deve ser colocado o restante do seu JavaScript
    function salvarEstoqueNoLocalStorage() {
      localStorage.setItem("estoque", JSON.stringify(estoque));
    }

    // Função para carregar os dados da tabela de estoque do armazenamento local
    function carregarEstoqueDoLocalStorage() {
      var estoqueSalvo = localStorage.getItem("estoque");

      if (estoqueSalvo) {
        estoque = JSON.parse(estoqueSalvo);
        exibirEstoque();
        calcularSomaEstoque();
      }
    }

    // Adicione esta função para salvar os dados da tabela de estoque ao fechar a página
    window.onbeforeunload = function() {
      salvarEstoqueNoLocalStorage();
    };

    // Chame a função carregarEstoqueDoLocalStorage ao carregar a página
    window.onload = function() {
      carregarEstoqueDoLocalStorage();
      carregarDadosDoLocalStorage();
      exibirEstoque();
      calcularSomaEstoque();
    };
  </script>
  <div id="botao">
    <button onclick="acessarAlteracaoEstoque()">Alterar Estoque (Senha)</button>
    <button onclick="limparDadosLocalStorage()">Limpar Dados (senha)</button>

  </div>

  
</body>
</html>